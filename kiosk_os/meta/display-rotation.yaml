name: display-rotation
mmdebstrap:
  packages:
    - xserver-xorg
    # Utilities and drivers useful for screen rotation
    - x11-xserver-utils    # provides xrandr
    - xserver-xorg-video-fbdev
    - libdrm2
    - mesa-utils
    - libgles2-mesa
    - libegl1-mesa
  install-recommends: false
  customize-hooks:
    - chroot $1 sh -c "mkdir -p /etc/X11/Xsession.d"
    - chroot $1 sh -c "echo '#!/bin/sh\nsleep 5\n# Try to detect HDMI output and rotate\nfor output in \$(xrandr | grep \" connected\" | cut -d\" \" -f1); do\n    xrandr --output \$output --rotate right\ndone' > /etc/X11/Xsession.d/99-rotate && chmod +x /etc/X11/Xsession.d/99-rotate"